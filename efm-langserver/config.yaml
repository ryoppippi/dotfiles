version: 2
log-level: 1
root-markers:
- .git/
- package.json

tools:
  stylua: &stylua
    format-command: "stylua -s --color Never -"
    format-stdin: true
    root-markers:
      - stylua.toml
      - .stylua.toml

  mypy: &mypy
    lint-command: 'mypy --show-column-numbers'
    lint-formats:
      - '%f:%l:%c: %trror: %m'
      - '%f:%l:%c: %tarning: %m'
      - '%f:%l:%c: %tote: %m'

  ruff-format: &ruff-format
    format-command: "ruff --fix -e -n --stdin-filename -"
    format-stdin: true

  html-prettier: &html-prettier
    format-command: "prettier ${--tab-width:tabWidth} ${--single-quote:singleQuote} --parser html"
    format-stdin: true

  prettier: &prettier
    format-command: "prettier --stdin --stdin-filepath ${INPUT} ${--range-start:charStart} ${--range-end:charEnd} ${--tab-width:tabSize} ${--use-tabs:!insertSpaces}"
    format-stdin: true
    format-can-range: true
    root-markers:
      - .prettierrc
      - .prettierrc.json
      - .prettierrc.js
      - .prettierrc.yml
      - .prettierrc.yaml
      - .prettierrc.json5
      - .prettierrc.mjs
      - .prettierrc.cjs
      - .prettierrc.toml

  deno-format: &deno-format
    format-command: "deno fmt"
    format-stdin: true
    format-diff: "deno fmt --unstable -"
    root-markers:
      - deno.json
      - deno.jsonc

  fish_indent: &fish_indent
    format-command: "fish_indent"
    format-stdin: true

  fish_diagnostics: &fish_diagnostics
    lint-command: "fish --no-execute ${INPUT}"
    lint-stdin: true
    lint-ignore-exit-code: true
    lint-formats:
      - '%.%#(line %l): %m'

  hadolint: &hadolint
    lint-command: 'hadolint'
    lint-stdin: true
    lint-formats:
      - '%f:%l %m'

  actionlint-lint: &actionlint-lint
    prefix: actionlint
    lint-command: "bash -c \"[[ '${INPUT}' =~ \\\\.github/workflows/ ]]\" && actionlint -oneline -no-color -"
    lint-stdin: true
    lint-formats:
      - "%f:%l:%c: %m"
    root-markers:
      - .github

  fixjson: &fixjson
    format-command: >
      deno run --allow-all --no-config --no-lock --node-modules-dir=false
      npm:fixjson --stdin-filename ${INPUT}
    format-stdin: true

languages:
  # lua
  lua:
    - <<: *stylua

  # python
  python:
    - <<: *mypy
    - <<: *ruff-format

  # web
  ## markup
  html:
    - <<: *html-prettier
  svelte:
    - <<: *prettier
  vue:
    - <<: *prettier
  astro:
    - <<: *prettier
  javascriptreact:
    - <<: *prettier
    - <<: *deno-format
  javascript.jsx:
    - <<: *prettier
    - <<: *deno-format
  typescriptreact:
    - <<: *prettier
    - <<: *deno-format
  typescript.tsx:
    - <<: *prettier
    - <<: *deno-format
  markdown:
    - <<: *prettier
    - <<: *deno-format
  markdown.mdx:
    - <<: *prettier
    - <<: *deno-format
  ## styles
  css:
    - <<: *prettier
  scss:
    - <<: *prettier
  less:
    - <<: *prettier
  ## scripts
  javascript:
    - <<: *prettier
    - <<: *deno-format
  typescript:
    - <<: *prettier
    - <<: *deno-format
  ## other
  graphql:
    - <<: *prettier
  handlebars:
    - <<: *prettier

  # config
  json:
    - <<: *fixjson
    - <<: *prettier
    - <<: *deno-format
  jsonc:
    - <<: *prettier
    - <<: *deno-format
  yaml:
    - <<: *prettier
    - <<: *actionlint-lint

  # shell
  fish:
    - <<: *fish_diagnostics
    - <<: *fish_indent

  # docker
  dockerfile:
    - <<: *hadolint
